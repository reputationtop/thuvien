{% extends "library/layout.html" %}
{% load humanize %}
{% block title %}Quản lí sách{% endblock %}
{% block body %}
    <div class="row pb-4 justify-content-center">
        <div>
            {% if  user.is_authenticated %}
                {% if user.is_superuser %} 

                    <div style="display: flex;
                    flex-direction: row;
                    justify-content: space-between;">
                        <h2 >Tổng kho sách</h2>  
                        <div >
                            <button class="btn btn-sm btn-outline-secondary" id="book-list" style="border-bottom: thick solid red ;">Cần thao tác</button> 
                            <button class="btn btn-sm btn-outline-secondary" id="book-like" style="border-bottom: thick solid #6c757d;">Đã ẩn/xóa</button>                            
                        </div>
                    </div>
                    <div id= "book_list" style="display: block;">
                        {% if list_all %}
                        
                            <table>
                                <tr>
                                    <th></th>
                                    <th>Tên cuốn sách</th>
                                    <th>Trang thái</th>
                                    <th>Thời gian</th>
                                </tr>
                                {% for list in  list_all %}
                                    {% if list.dele_listing == False %}
                                        {% if  list.active %}
                                            <tr>
                                                <td><a href="{% url 'book' list.item.id%}"><img style="display: block;width: 80px ;height: 80px ;float: left;"  src="/library/media/{{list.item.image}}"></a></td>
                                                <td><a href="{% url 'book' list.item.id%}">{{list.item.namebook}}</a></td>
                                                
                                                <td>                                                    
        
                                                    <button data-listid="{{ list.id }}"  class="btn close-book " style="color:red;" name="close_cation" >Kết thúc</button>

                                                </td>
                                                <td>Hạn trả{{list.convert_date}}</td>
                                            </tr>
                                        {% else %}
                                            <tr>
                                                <td><a href="{% url 'book' list.item.id%}"><img style="display: block;width: 80px ;height: 80px ;float: left;"  src="/library/media/{{list.item.image}}"></a></td>
                                                <td><a href="{% url 'book' list.item.id%}">{{list.item.namebook}}</a></td>
                                                
                                                <td>
                                                    <div class=" flex_img">
                                                        <button data-listid="{{ list.id }}"  class="btn close-book " style="color:red;" name="close_cation" >Từ chối</button>
                                                        <div id="list{{ list.id }}"></div> 
                                                        <button data-listid="{{ list.id }}"
                                                            class="btn  edit_change " style="color:blue;" >Chấp nhận
                                                        </button>  
                                                    </div>
        
                                                </td>
                                                <td>{{list.timel}}</td>
                                            </tr>
                                        {% endif %}

                                    {% endif %}
                            
                            
                                {% endfor %}
                            </table>
                        


                        {% else %}
                            <h3 style="color:red"><strong> không có sách cần thao tác.</strong></h3>
                        {% endif %}
                    </div>

                    <div id ="book_like" style="display: none;">
                        
                        {% if all_book %}
                            <table>
                                <tr>
                                    <th></th>
                                    <th>Tên cuốn sách</th>
                                    <th>Trang thái</th>
                                    <th>Tùy chọn</th>
                                </tr>
                                {% for bok in all_book %}
                                    {% if bok.numbe_book == 0 %}
                                        <tr>
                                            <td><a href="{% url 'book' bok.id%}"><img style="display: block;width: 80px ;height: 80px ;float: left;"  src="/library/media/{{bok.image}}"></a></td>
                                            <td><a href="{% url 'book' bok.id%}">{{bok.namebook}}</a></td>
                                            
                                            <td> <small style="color:black;">sách này đã cho mượn hết</small></td>
                                            <td></td>
                                        </tr>

                                    {% elif bok.dele_book == False%}
                                        <tr>
                                            <td><a href="{% url 'book' bok.id%}"><img style="display: block;width: 80px ;height: 80px ;float: left;"  src="/library/media/{{bok.image}}"></a></td>
                                            <td><a href="{% url 'book' bok.id%}">{{bok.namebook}}</a></td>
                                            <td> <small style="color:black;">sách này đã ngưng cho mượn</small></td>
                                            <td></td>
                                        </tr>
                                    
                                    {% endif %}
                                {% endfor %}
                            </table>
                        {% else %}
                            <h3 style="color:red"><strong> không có sách cần thao tác.?</strong></h3>
                        {% endif %}
                    </div>

                {% else %}
                <div style="display: flex;
                flex-direction: row;
                justify-content: space-between;">
                        <h2 >Tổng kho sách</h2>  
                        <div style="text-align:right;">
                            <button class="btn  btn-outline-secondary" id="book-list" style="border-bottom: thick solid red ;">Kho sách</button> 
                            <button class="btn btn-outline-secondary" id="book-like" style="border-bottom: thick solid #6c757d;">Đề xuất</button>                            
                        </div>  
                    </div>              

                    <div id="book_list" style="display: block;">

                        {% if list_all %}
                            <strong>  Số dư : {{user.money}}</strong>
                            <small>Số sách có thể mượn thêm: {{ user.limit_book}}</small>
                            {% include "library/includes//table_book.html" with list_all=list_all %}



            
                        {% else %}
                            <h3 style="color:red"><strong> không có sách đã tương tác !</strong></h3>
                        {% endif %}                        
                    </div>

                    <div id ="book_like" style="display: none;">

                        {% if up_top %}
                            {% for book in up_top %}
                            
                                <div class="card">
                                    <div class="m-2 ">
        
                                        <a href="{% url 'book' book.id%}" class="text-decoration-none text-dark">
                                            <h5 class="card-title text-truncate">{{ book.namebook }}</h5>
                                            <img src="/library/media/{{book.image}}"  class="card-img-top" >
                                            <small>{{ book.description}}</small>
                                        </a>
                                    </div>
                                </div>                           
                            {% endfor %}
                        
                            {% comment %} <div class="card m-2 " style="width: 20rem;"> {% endcomment %}
                        {% else %}
                            <h3 style="color:red"><strong> Không có sách đề xuất !</strong></h3>
                        {% endif %}

                    </div>
                {% endif %}

            {% else %}
                <h3 style="color:red"><strong> Bạn chưa đăng nhập !!!</strong></h3>
                <h4 ><a class="btn btn-primary" href="{% url 'login' %}">Nhấn vào đây để đăng nhập.</a></h4>
            
            
            {% endif %}
        </div>
    </div>
    <script>
        document.getElementById("book-list").onclick = function () {
            document.getElementById("book_like").style.display = 'none';
            document.getElementById("book_list").style.display = 'block';
            document.getElementById("book-like").style.borderBottom ='thick solid #6c757d';
            document.getElementById("book-list").style.borderBottom ='thick solid red ';

        };   
        document.getElementById("book-like").onclick = function () {
            document.getElementById("book_like").style.display = 'block';
            document.getElementById("book_list").style.display = 'none';
            document.getElementById("book-list").style.borderBottom = "thick solid #6c757d";
            document.getElementById("book-like").style.borderBottom = "thick solid red "; 

        };         
    </script>

    {% comment %} <script language = "javascript" type = "text/javascript">
        document.getElementById("book-list").onclick = function () {
            document.getElementById("book_like").style.display = 'none';
            document.getElementById("book_list").style.display = 'block';
            document.getElementById("book-like").style.border-bottom='1 px solid transparent';
            document.getElementById("book-list").style.border-bottom='2px solid red';

        };   
        document.getElementById("book-like").onclick = function () {
            document.getElementById("book_like").style.display = 'none';
            document.getElementById("book_list").style.display = 'block';
            document.getElementById("book-list").style.border-bottom='1 px solid transparent';
            document.getElementById("book-like").style.border-bottom='2px solid red';            
        }; 
     </script>   {% endcomment %}

{% endblock %}